<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Start New Game</title>
  <style>
    .score-bar{
      display: flex; 
      flex-direction :row;
      justify-content: space-around;
    }

    .game-area__header {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .game {
      display: flex;
      flex-direction: row;
      justify-content: space-evenly;
    }
  </style>
</head>
<body>
  <div class="container">
      <a href="index.html">Back home</a>
      <div class="row">
        <div class="score-bar">
            <div>Player 1: <span class="player_one"></span> Score: <span class="player_one__score"></span></div>
            <div>Bop, Bop, Boop!</div>
            <div>Player 2: <span class="player_two"></span> Score: <span class="player_two__score"></span></div>
        </div> 
   
      </div>

      <!-- card deck and player selection -->
      <div class="row">
        <div class="game-area__header">
          <div class="game-area__chooser"><span class="message">make a selection</span></div>
          <div class="card-deck">Number of cards: <span class="cards-remaining"></span></div>
        </div>
      </div>

      <div class="row game">
        <div class="col-md-3">
          <button class="game-area__new-game-btn" onclick="newGame()">Start New Game</button>
          <button class="game-area__player-flip" onclick="flipCard()"><span class="current_player">flip</span></button>
        </div>
     
        <div class="col-md-3">
          <div class="player_one_card"></div>
        </div>
        <div class="col-md-3">
          <div class="player_two_card"></div>
        </div>
        <div class="col-md-3">
          <button class="game-area__new-game-btn" onclick="shuffleDeck()">Shuffle Deck</button>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="display-winner"></div>
      <button onclick="clear()">Clear</button>
     
    </div>
    
  </div>

  
  <script>
    //players
    const playerOne = JSON.parse(localStorage.getItem('playerOne')) || { name: 'Player 1', points: 0, turn: true };
    const playerTwo = JSON.parse(localStorage.getItem('playerTwo')) || { name: 'Player 2', points: 0, turn: false };

    //display players
    document.querySelector('.player_one').innerHTML = playerOne.name;
    document.querySelector('.player_two').innerHTML = playerTwo.name;

    //Number of cards remaining in deck
    let gameDeck = localStorage.getItem('gameDeck') ? JSON.stringify(localStorage.getItem('gameDeck')) : [];

    const cards = [
        // { cardType: 'Spade', cardValue: 'Big Joker' },
        // { cardType: 'Spade', cardValue: 'Little Joker' },
        { id: 1, cardType: 'Spade', cardValue: 'Ace', cardWeight: 27 },
        { id: 2, cardType: 'Spade', cardValue: 'King', cardWeight: 26 },
        { id: 3, cardType: 'Spade', cardValue: 'Queen', cardWeight: 25 },
        { id: 4, cardType: 'Spade', cardValue: 'Jack', cardWeight: 24 },
        { id: 5, cardType: 'Spade', cardValue: '10', cardWeight: 23 },
        { id: 6, cardType: 'Spade', cardValue: '9', cardWeight: 22 },
        { id: 7, cardType: 'Spade', cardValue: '8', cardWeight: 21 },
        { id: 8, cardType: 'Spade', cardValue: '7', cardWeight: 20 },
        { id: 9, cardType: 'Spade', cardValue: '6', cardWeight: 19 },
        { id: 10, cardType: 'Spade', cardValue: '5', cardWeight: 18 },
        { id: 11, cardType: 'Spade', cardValue: '4', cardWeight: 17 },
        { id: 12, cardType: 'Spade', cardValue: '3', cardWeight: 16 },
        { id: 13, cardType: 'Spade', cardValue: '2', cardWeight: 15 },
        { id: 14, cardType: 'Diamond', cardValue: 'Ace', cardWeight: 14 },
        { id: 15, cardType: 'Diamond', cardValue: 'King', cardWeight: 13 },
        { id: 16, cardType: 'Diamond', cardValue: 'Queen', cardWeight: 12 },
        { id: 17, cardType: 'Diamond', cardValue: 'Jack', cardWeight: 11 },
        { id: 18, cardType: 'Diamond', cardValue: '10', cardWeight: 10 },
        { id: 19, cardType: 'Diamond', cardValue: '9', cardWeight: 9 },
        { id: 20, cardType: 'Diamond', cardValue: '8', cardWeight: 8 },
        { id: 21, cardType: 'Diamond', cardValue: '7', cardWeight: 7 },
        { id: 22, cardType: 'Diamond', cardValue: '6', cardWeight: 6 },
        { id: 23, cardType: 'Diamond', cardValue: '5', cardWeight: 5 },
        { id: 24, cardType: 'Diamond', cardValue: '4', cardWeight: 4 },
        { id: 25, cardType: 'Diamond', cardValue: '3', cardWeight: 3 },
        { id: 26, cardType: 'Diamond', cardValue: '2', cardWeight: 2 },
        { id: 27, cardType: 'Club', cardValue: 'Ace', cardWeight: 14 },
        { id: 28, cardType: 'Club', cardValue: 'King', cardWeight: 13 },
        { id: 29, cardType: 'Club', cardValue: 'Queen', cardWeight: 12 },
        { id: 30, cardType: 'Club', cardValue: 'Jack', cardWeight: 11 },
        { id: 31, cardType: 'Club', cardValue: '10', cardWeight: 10 },
        { id: 32, cardType: 'Club', cardValue: '9', cardWeight: 9 },
        { id: 33, cardType: 'Club', cardValue: '8', cardWeight: 8 },
        { id: 34, cardType: 'Club', cardValue: '7', cardWeight: 7 },
        { id: 35, cardType: 'Club', cardValue: '6', cardWeight: 6 },
        { id: 36, cardType: 'Club', cardValue: '5', cardWeight: 5 },
        { id: 37, cardType: 'Club', cardValue: '4', cardWeight: 4 },
        { id: 38, cardType: 'Club', cardValue: '3', cardWeight: 3 },
        { id: 39, cardType: 'Club', cardValue: '2', cardWeight: 2 },
        { id: 40, cardType: 'Heart', cardValue: 'Ace', cardWeight: 14 },
        { id: 41, cardType: 'Heart', cardValue: 'King', cardWeight: 13 },
        { id: 42, cardType: 'Heart', cardValue: 'Queen', cardWeight: 12 },
        { id: 43, cardType: 'Heart', cardValue: 'Jack', cardWeight: 11 },
        { id: 44, cardType: 'Heart', cardValue: '10', cardWeight: 10 },
        { id: 45, cardType: 'Heart', cardValue: '9', cardWeight: 9 },
        { id: 46, cardType: 'Heart', cardValue: '8', cardWeight: 8 },
        { id: 47, cardType: 'Heart', cardValue: '7', cardWeight: 7 },
        { id: 48, cardType: 'Heart', cardValue: '6', cardWeight: 6 },
        { id: 49, cardType: 'Heart', cardValue: '5', cardWeight: 5 },
        { id: 50, cardType: 'Heart', cardValue: '4', cardWeight: 4 },
        { id: 51, cardType: 'Heart', cardValue: '3', cardWeight: 3 },
        { id: 52, cardType: 'Heart', cardValue: '2', cardWeight: 2 },
        { id: 53, cardType: 'Bop', cardValue: 'Pass to next player', cardWeight: 28 },
        { id: 54, cardType: 'Bop', cardValue: 'Pass to next player', cardWeight: 28 },
        { id: 55, cardType: 'Bop', cardValue: 'Pass to next player', cardWeight: 28 },
        { id: 56, cardType: 'Bop', cardValue: 'Pass to next player', cardWeight: 28 },
        { id: 57, cardType: 'Booop', cardValue: 'Take a double shot', cardWeight: 0 },
      ];

      function initializeGame(){
        localStorage.clear();
        //Do not display user until new game
        document.querySelector('.game-area__chooser').style.display = 'none';
        document.querySelector('.cards-remaining').innerHTML = 0;

        document.querySelector('.game-area__player-flip').style.display = 'none';
      }

      initializeGame();

      function newGame() {
        localStorage.setItem('player_choice', 'player_one');
        //display player one and player choice
        document.querySelector('.game-area__chooser').style.display = 'block';
        document.querySelector('.game-area__player-flip').style.display = 'block';

        document.querySelector('.game-area__chooser').innerHTML = `${playerOne.name} make a selection` ;
        document.querySelector('.game-area__player-flip').innerHTML = `${playerOne.name } flip`;

        document.querySelector('.game-area__new-game-btn').style.display = 'none';
        //shuffle game deck store new deck
        localStorage.setItem('gameDeck', JSON.stringify(shuffle(cards)));

        //Set initial deck count
        document.querySelector('.cards-remaining').innerHTML = JSON.parse(localStorage.getItem('gameDeck')).length;

        //set player points to zero
        document.querySelector('.player_one__score').innerHTML = playerOne.points;
        document.querySelector('.player_two__score').innerHTML = playerTwo.points;
      }

      function shuffle(a) {
        for (let i = a.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
      }

      function clear(){
        document.querySelector('.display-winner').innerHTML = '';
        //Move to player 2
        localStorage.setItem('player_choice', 'player_one');
        document.querySelector('.game-area__chooser').innerHTML = `${playerOne.name} make a selection`;
        document.querySelector('.game-area__player-flip').innerHTML = `${playerOne.name} flip`;
      }

      function flipCard() {
        //random choose a 
        const userChoice = localStorage.getItem('player_choice');
        let updatedDeck;

        gameDeck = JSON.parse(localStorage.getItem('gameDeck'));

        let nextCard;

        if(userChoice === "player_one"){
          nextCard = gameDeck[0];
          //set firstCardOption 
          localStorage.setItem('firstCardOption', JSON.stringify(nextCard.cardWeight));
          document.querySelector('.player_one_card').innerHTML = `Player one ${nextCard.cardType} ${nextCard.cardValue}`;

          //display card
          updatedDeck = JSON.stringify(gameDeck.filter(item => item.id !== nextCard.id));
          localStorage.setItem('gameDeck', updatedDeck);
          document.querySelector('.cards-remaining').innerHTML = JSON.parse(localStorage.getItem('gameDeck')).length;

          //Move to player 2
          localStorage.setItem('player_choice', 'player_two');
          document.querySelector('.game-area__chooser').innerHTML = `${playerTwo.name} make a selection`;
          document.querySelector('.game-area__player-flip').innerHTML = `${playerTwo.name} flip`;
        }

        if(userChoice === "player_two"){
          nextCard = gameDeck[0];
          localStorage.setItem('secondCardOption', JSON.stringify(nextCard.cardWeight));
          document.querySelector('.player_two_card').innerHTML = `Player two ${nextCard.cardType} ${nextCard.cardValue}`;

          //display card
          updatedDeck = JSON.stringify(gameDeck.filter(item => item.id !== nextCard.id));
          localStorage.setItem('gameDeck', updatedDeck);
          document.querySelector('.cards-remaining').innerHTML = JSON.parse(localStorage.getItem('gameDeck')).length;

          //card choices
          const firstCard = parseInt(localStorage.getItem('firstCardOption'));
          const secondCard = parseInt(localStorage.getItem('secondCardOption'));
     
          if(firstCard === 0 && secondCard === 28){
            document.querySelector('.display-winner').innerHTML = `${playerOne.name} got BOPPED and must take 3 shots`;
          } else if (firstCard === 28 && secondCard === 28) {
            document.querySelector('.display-winner').innerHTML = `$Both players must take a shot`;
          } else if (firstCard === 28 && secondCard === 0) {
            document.querySelector('.display-winner').innerHTML = `${playerTwo.name} got BOPPED and must take 3 shots`;
          } else if( firstCard === 28 && secondCard !== 0 || 28){
            document.querySelector('.display-winner').innerHTML = `${playerTwo.name} got BOPPED and must take 1 shots`;
          } else if (firstCard === 28 && secondCard !== 0 || 28) {
            document.querySelector('.display-winner').innerHTML = `${playerTwo.name} got BOPPED and must take 1 shots`;
          } else if(firstCard > secondCard){
            document.querySelector('.display-winner').innerHTML = `${playerOne.name} wins. ${playerTow.name} take a shot`;
          } else {
            document.querySelector('.display-winner').innerHTML = `${playerTwo.name} wins. ${playerOne.name} take a shot`;
          }
        }
      }
    
  </script>
</body>
</html>